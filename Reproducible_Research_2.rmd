---
title: "Reproducible Research Assignment 2"
author: "Project_H"
date: "March 15, 2016"
output: html_document
keep_md: true
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Data Processing
Loading data: readr's read_csv is used to load the data, as it is an order of magnitude faster than the base read.csv. Unfortunately, the data file crashes data.table 1.9.6's fread function.

Summarizing data: For each Event Type, sum the fatalities, injuries, property damage, and crop damage.
```{r load_data}
library(data.table)
library(readr)
dataset <- data.table(read_csv('../repdata-data-StormData.csv.bz2'))

# Extract a summary of storm data events.
StormSum1 <- dataset[, lapply(.SD, sum, na.rm=TRUE), by=EVTYPE, 
                     .SDcols=c('FATALITIES', 'INJURIES', 'PROPDMG', 'CROPDMG')]

# Convert all EventTypes to upper case to reduce variation in Event Types
StormSum1[,EVTYPE := toupper(EVTYPE)]

# Get rid of spelling variations.
StormSum1[EVTYPE == 'AVALANCE',  EVTYPE := 'AVALANCHE']
StormSum1[EVTYPE == 'BEACH EROSIN',  EVTYPE := 'BEACH EROSION']
StormSum1[EVTYPE == 'TORNDAO',  EVTYPE := 'TORNADO']

# Melt the summary to prepare for re-calcuating the sums for each Event Type.
StormMelt <- melt.data.table(StormSum1, id.vars = 'EVTYPE', variable.name = 'DamageType')

# Redo the summary table.
StormSum2 <- dcast(StormMelt, EVTYPE ~ DamageType, value.var = 'value', fun.aggregate = sum )

```

## 


